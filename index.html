<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Ankit Chaubey ‚Äî Projects & Profile</title>
  <meta name="description" content="Ankit Chaubey ‚Äî curiosity-driven learner. Systems, APIs, automation, and low-level tooling." />
  <meta name="theme-color" content="#0b1220" />

  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

  <style>
    /* (same CSS as before ‚Äî unchanged) */
    :root{
      --bg:#0b1220; --panel:#0f172a; --text:#e6eef6; --muted:#9ca3af;
      --accent:#38bdf8; --accent-2:#7c3aed; --border:rgba(255,255,255,0.06);
      --card-radius:14px; --shadow:0 12px 36px rgba(2,6,23,0.55); --transition:300ms;
    }
    body.light{ --bg:#f8fafc; --panel:#fff; --text:#071022; --muted:#475569; --accent:#0284c7; --accent-2:#7c3aed; --border:rgba(15,23,42,0.06); --shadow:0 8px 24px rgba(2,6,23,0.06) }
    body.amoled{ --bg:#000; --panel:#000; --text:#e6eef6; --muted:#9aa4b2; --accent:#00e5ff; --accent-2:#ff3b99; --border:rgba(255,255,255,0.04); --shadow:none }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;font-family:Inter,system-ui,-apple-system,"Segoe UI",Roboto,Arial;
      color:var(--text); background:
      radial-gradient(900px 360px at 12% -12%, rgba(56,189,248,0.06), transparent),
      var(--bg);
      transition:background var(--transition), color var(--transition);
      -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale;
      line-height:1.5; padding-bottom:48px;
    }
    a{color:var(--accent)} a:hover{text-decoration:underline}
    .container{max-width:1100px;margin:28px auto;padding:22px}
    .theme-overlay{pointer-events:none;position:fixed;inset:0;background:var(--bg);opacity:0;transition:opacity 260ms;z-index:9999}
    .theme-changing .theme-overlay{opacity:1}
    header.top{display:flex;justify-content:space-between;align-items:center;gap:16px;margin-bottom:22px}
    .left{display:flex;align-items:center;gap:16px}
    .avatar{width:96px;height:96px;border-radius:50%;overflow:hidden;border:1px solid var(--border);background:linear-gradient(135deg,var(--accent),var(--accent-2));flex-shrink:0}
    .avatar img{width:100%;height:100%;object-fit:cover;display:block}
    h1{font-size:2rem;margin:0 0 6px 0}
    .subtitle{margin:0;color:var(--muted);max-width:720px}
    .controls{display:flex;gap:8px;align-items:center}
    .btn{background:linear-gradient(180deg,var(--panel),transparent);border:1px solid var(--border);padding:8px 12px;border-radius:999px;color:var(--text);cursor:pointer;font-weight:600;display:inline-flex;align-items:center;gap:8px}
    .btn:active{transform:translateY(1px)} .btn:focus{outline:3px solid rgba(56,189,248,0.12);outline-offset:4px}
    .grid{display:grid;grid-template-columns:1fr 360px;gap:20px}
    @media(max-width:980px){.grid{grid-template-columns:1fr}}
    .card{background:linear-gradient(180deg,var(--panel),transparent);border-radius:var(--card-radius);padding:18px;border:1px solid var(--border);box-shadow:var(--shadow);transition:transform 220ms}
    .card h2{margin:0 0 8px 0}
    .stats{display:flex;gap:12px;flex-wrap:wrap;margin-top:12px}
    .stat{background:rgba(255,255,255,0.02);padding:8px 10px;border-radius:10px;border:1px solid var(--border);color:var(--muted);font-weight:700}
    .repo-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(240px,1fr));gap:14px;margin-top:12px}
    .repo{padding:12px;border-radius:12px;border:1px solid var(--border);background:linear-gradient(180deg, rgba(255,255,255,0.01), transparent)}
    .repo h3{margin:0 0 8px 0;font-size:1rem}
    .repo p{margin:0;color:var(--muted);min-height:42px}
    .meta-row{display:flex;gap:10px;align-items:center;margin-top:10px;color:var(--muted);flex-wrap:wrap}
    .meta-row .small{font-size:0.88rem}
    .lang-list{display:flex;gap:8px;flex-wrap:wrap}
    .lang-pill{display:inline-flex;align-items:center;gap:8px;padding:6px 8px;border-radius:999px;border:1px solid var(--border);font-weight:700;color:var(--muted);font-size:0.86rem}
    @media(max-width:520px){ .repo p{min-height:28px} .meta-row{flex-direction:row} header.top{flex-direction:column;align-items:flex-start;gap:12px} }
    .contrib{width:100%;border-radius:8px;overflow:hidden;border:1px solid var(--border);margin-top:8px}
    .contrib img{display:block;width:100%;height:auto}
    .fade{opacity:0;transform:translateY(8px);transition:opacity 420ms,transform 420ms}
    .fade.show{opacity:1;transform:none}
    .skeleton{background:linear-gradient(90deg, rgba(255,255,255,0.02), rgba(255,255,255,0.04), rgba(255,255,255,0.02));height:12px;border-radius:6px;animation:shimmer 1.6s linear infinite}
    @keyframes shimmer{0%{background-position:-200px 0}100%{background-position:200px 0}}
    footer{text-align:center;margin-top:28px;color:var(--muted)}
  </style>
</head>
<body>
  <div class="theme-overlay" aria-hidden="true"></div>

  <main class="container" role="main" aria-live="polite">
    <!-- (the HTML content remains the same as your file) -->
    <header class="top fade" role="banner">
      <div class="left">
        <div class="avatar" id="avatarWrap"><img id="avatar" src="" alt="Avatar"></div>
        <div>
          <h1 id="name">Ankit Chaubey</h1>
          <p class="subtitle" id="bio">Curiosity-driven learner exploring systems, APIs, automation, and low-level tooling.</p>
          <p style="margin:6px 0 0 0;color:var(--muted)" id="joined">Joined: ‚Äî ¬∑ Username: <span id="login">‚Äî</span></p>
        </div>
      </div>

      <nav class="controls" aria-label="Site controls">
        <a id="profileBtn" class="btn" href="#" target="_blank" rel="noopener">View GitHub</a>
        <button id="themeBtn" class="btn" aria-label="Toggle theme">Theme</button>
      </nav>
    </header>

    <div class="grid">
      <section class="card fade" aria-labelledby="aboutTitle">
        <h2 id="aboutTitle">About</h2>
        <p id="aboutText">I‚Äôm a college student from India who enjoys understanding how systems work by building small tools, experimenting with APIs, and automating workflows.</p>

        <div style="display:flex;gap:16px;align-items:flex-start;margin-top:12px">
          <div style="flex:1">
            <div class="stats" id="mainStats"><div class="stat">Loading‚Ä¶</div></div>

            <div style="margin-top:12px">
              <strong>What I use</strong>
              <div style="margin-top:8px;display:flex;flex-wrap:wrap;gap:8px">
                <span class="lang-pill">Python</span>
                <span class="lang-pill">Go</span>
                <span class="lang-pill">C / C++</span>
                <span class="lang-pill">Linux</span>
              </div>
            </div>
          </div>

          <div style="width:220px">
            <div class="contrib" aria-hidden="false" title="Contribution graph">
              <img id="contrib" src="/data/contrib.svg" alt="Contribution graph" onerror="this.style.display='none'">
            </div>
          </div>
        </div>

        <hr style="margin:16px 0;border:none;border-top:1px solid var(--border)">

        <div style="display:flex;justify-content:space-between;align-items:center">
          <h3 style="margin:0">Pinned / Top repositories</h3>
          <div id="lastCommit" style="color:var(--muted)">Last commit: ‚Äî</div>
        </div>

        <div id="pinned" class="repo-grid" style="margin-top:12px">
          <div class="repo"><div class="skeleton" style="width:60%"></div><div style="height:10px;margin-top:10px" class="skeleton"></div></div>
          <div class="repo"><div class="skeleton" style="width:60%"></div><div style="height:10px;margin-top:10px" class="skeleton"></div></div>
        </div>
      </section>

      <aside>
        <section class="card fade">
          <h3 style="margin-top:0">Contact</h3>
          <p style="margin:8px 0">
            <strong>Email:</strong> <a href="mailto:m.ankitchaubey@gmail.com">m.ankitchaubey@gmail.com</a><br>
            <strong>GitHub:</strong> <span id="loginInline">‚Äî</span><br>
            <strong>Telegram:</strong> <a href="https://t.me/ankify" target="_blank">@ankify</a>
          </p>
        </section>

        <section class="card fade" style="margin-top:14px">
          <h3 style="margin-top:0">Organizations</h3>
          <div id="orgs" style="margin-top:8px"><div class="skeleton" style="width:80%;height:12px;border-radius:6px"></div></div>
        </section>

        <section class="card fade" style="margin-top:14px">
          <h3 style="margin-top:0">Activity & summary</h3>
          <div style="margin-top:8px;color:var(--muted)">
            <div>Total public repos: <strong id="totalPublic">‚Äî</strong></div>
            <div>Source repos indexed: <strong id="totalSource">‚Äî</strong></div>
            <div>Total forks: <strong id="totalForks">‚Äî</strong></div>
            <div>Followers: <strong id="followers">‚Äî</strong></div>
            <div>Total commits (partial): <strong id="totalCommits">‚Äî</strong></div>
            <div style="margin-top:8px">Last updated: <strong id="updatedAt">‚Äî</strong></div>
          </div>
        </section>
      </aside>
    </div>

    <section class="card fade" style="margin-top:20px">
      <h2 style="margin-top:0">All repositories</h2>
      <div id="reposGrid" class="repo-grid" style="margin-top:12px">
        <div class="repo"><div class="skeleton" style="width:60%"></div><div style="height:10px;margin-top:10px" class="skeleton"></div></div>
        <div class="repo"><div class="skeleton" style="width:60%"></div><div style="height:10px;margin-top:10px" class="skeleton"></div></div>
      </div>
    </section>

    <footer class="fade" style="margin-top:24px">¬© <span id="year"></span> Ankit Chaubey ¬∑ Built with simplicity</footer>
  </main>

  <script>
    /*
      Robust viewer script:
      - computes DATA_BASE dynamically (works at / or /<repo>/)
      - fetches files with fallback and logs useful diagnostics
      - previously used absolute '/data' which can break when hosted under /profilev2/
    */

    (function(){
      // compute site base so path works for both root and repo pages
      function computeSiteBase(){
        // e.g. pathname = "/profilev2/" or "/profilev2/index.html" or "/"
        let p = location.pathname || '/';
        // if the path has a filename without trailing slash, remove it
        if(!p.endsWith('/')){
          const idx = p.lastIndexOf('/');
          p = idx >= 0 ? p.slice(0, idx+1) : '/';
        }
        // ensure it ends with slash
        if(!p.endsWith('/')) p += '/';
        return p;
      }

      const SITE_BASE = computeSiteBase();
      const DATA_BASE = SITE_BASE + 'data'; // e.g. '/profilev2/data' or '/data' depending on site
      console.debug('[profilev2] SITE_BASE:', SITE_BASE, 'DATA_BASE:', DATA_BASE);

      function dataUrl(filename){
        // normalize filename
        const name = filename.replace(/^\/+/, '');
        return `${DATA_BASE}/${name}`;
      }

      // fallback fetcher: try DATA_BASE first, then absolute /data/
      async function fetchJsonWithFallback(filename){
        const url1 = dataUrl(filename);
        try{
          console.debug('[profilev2] fetching', url1);
          const r = await fetch(url1, {cache:'no-cache'});
          if(r.ok) {
            console.debug('[profilev2] fetched', url1, 'OK');
            return await r.json();
          }
          console.warn('[profilev2] fetch returned', r.status, 'for', url1);
        }catch(e){
          console.warn('[profilev2] fetch error for', url1, e);
        }
        // fallback to absolute '/data'
        const url2 = `/data/${filename.replace(/^\/+/, '')}`;
        try{
          console.debug('[profilev2] fallback fetching', url2);
          const r2 = await fetch(url2, {cache:'no-cache'});
          if(r2.ok) return await r2.json();
          console.warn('[profilev2] fallback fetch returned', r2.status, 'for', url2);
        }catch(e){
          console.warn('[profilev2] fallback fetch error for', url2, e);
        }
        return null;
      }

      // update contrib image path robustly
      const contribImg = document.getElementById('contrib');
      if(contribImg){
        const contribPath1 = dataUrl('contrib.svg');
        contribImg.src = contribPath1;
        // also set fallback onerror to try root /data/
        contribImg.onerror = () => { if(!contribImg.dataset.fallback) { contribImg.dataset.fallback = '1'; contribImg.src = '/data/contrib.svg'; } };
      }

      // DOM refs
      const qs = s => document.querySelector(s);
      const avatarEl = qs('#avatar');
      const nameEl = qs('#name');
      const bioEl = qs('#bio');
      const joinedEl = qs('#joined');
      const profileBtn = qs('#profileBtn');
      const loginEl = qs('#login');
      const loginInlineEl = qs('#loginInline');
      const mainStatsEl = qs('#mainStats');
      const pinnedContainer = qs('#pinned');
      const reposGrid = qs('#reposGrid');
      const orgsContainer = qs('#orgs');
      const lastCommitEl = qs('#lastCommit');
      const totalPublicEl = qs('#totalPublic');
      const totalSourceEl = qs('#totalSource');
      const totalForksEl = qs('#totalForks');
      const followersEl = qs('#followers');
      const totalCommitsEl = qs('#totalCommits');
      const updatedAtEl = qs('#updatedAt');
      const yearEl = qs('#year');

      // helpers
      function fmtDate(iso){ if(!iso) return '‚Äî'; try{ return new Date(iso).toLocaleDateString(); }catch(e){ return iso; } }
      function esc(s){ return s ? s.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;') : ''; }
      function langColor(lang){ const M = {'JavaScript':'#f1e05a','TypeScript':'#2b7489','Python':'#3572A5','Go':'#00ADD8','C':'#555','C++':'#f34b7d','Rust':'#dea584','Java':'#b07219','HTML':'#e34c26','CSS':'#563d7c','Shell':'#89e051'}; return M[lang] || '#94a3b8'; }

      yearEl.textContent = new Date().getFullYear();

      // repo card
      function repoCard(r){
        const div = document.createElement('div');
        div.className = 'repo';
        const homepage = r.homepage ? `<a href="${r.homepage}" target="_blank" rel="noopener noreferrer">Website</a> ¬∑ ` : '';
        const desc = r.description ? esc(r.description) : 'No description provided.';
        const latest = r.latest_commit && r.latest_commit.date ? `Last commit: ${fmtDate(r.latest_commit.date)}` : `Updated: ${fmtDate(r.pushed_at)}`;
        let langsHtml = '';
        if(r.languages && Object.keys(r.languages).length){
          const entries = Object.entries(r.languages).sort((a,b)=>b[1]-a[1]).slice(0,4);
          const total = entries.reduce((s,[,v])=>s+v,0);
          const pills = entries.map(([lang,bytes])=> {
            const pct = Math.round((bytes/total)*100);
            return `<span class="lang-pill"><span style="width:10px;height:10px;border-radius:50%;display:inline-block;background:${langColor(lang)}"></span>${esc(lang)} ${pct}%</span>`;
          }).join(' ');
          langsHtml = `<div class="lang-list">${pills}</div>`;
        }
        const commitMsg = r.latest_commit && r.latest_commit.message ? ` ¬∑ "${esc(r.latest_commit.message)}"` : '';
        div.innerHTML = `
          <h3><a href="${r.html_url}" target="_blank" rel="noopener">${esc(r.name)}</a></h3>
          <p>${desc}</p>
          ${langsHtml}
          <div class="meta-row">
            <div class="small">${homepage}‚òÖ ${r.stargazers_count || 0} ¬∑ Forks: ${r.forks_count || 0}</div>
            <div class="small">${latest}${commitMsg}</div>
          </div>
        `;
        return div;
      }

      // main loader with diagnostics
      (async function loadAll(){
        console.debug('[profilev2] starting data load from', DATA_BASE);

        // summary
        const summary = await fetchJsonWithFallback('summary.json');
        if(summary){
          totalPublicEl.textContent = summary.total_public_repos ?? '‚Äî';
          totalSourceEl.textContent = summary.source_repos_count ?? '‚Äî';
          totalForksEl.textContent = summary.total_forks ?? '‚Äî';
          followersEl.textContent = summary.followers ?? '‚Äî';
          totalCommitsEl.textContent = summary.total_commits ? `${summary.total_commits} (partial)` : '‚Äî';
          updatedAtEl.textContent = summary.updated_at ? fmtDate(summary.updated_at) : '‚Äî';
        } else {
          console.warn('[profilev2] summary.json not found or invalid');
        }

        // profile
        const profile = await fetchJsonWithFallback('profile.json');
        if(profile){
          avatarEl.src = profile.avatar_url || '';
          nameEl.textContent = profile.name || profile.login || '‚Äî';
          bioEl.textContent = profile.bio || '';
          joinedEl.textContent = `Joined: ${profile.created_at ? fmtDate(profile.created_at) : '‚Äî'} ¬∑ Username: ${profile.login || '‚Äî'}`;
          profileBtn.href = profile.html_url || '#';
          loginEl.textContent = profile.login || '‚Äî';
          loginInlineEl.textContent = profile.login || '‚Äî';
        } else {
          console.warn('[profilev2] profile.json not found or invalid');
        }

        // orgs
        const orgs = await fetchJsonWithFallback('orgs.json');
        if(Array.isArray(orgs) && orgs.length){
          orgsContainer.innerHTML = '';
          orgs.forEach(o=>{
            const d = document.createElement('div');
            d.style.display='flex'; d.style.gap='10px'; d.style.alignItems='center'; d.style.marginBottom='10px';
            d.innerHTML = `<img src="${o.avatar_url}" alt="${o.login}" style="width:44px;height:44px;border-radius:10px;object-fit:cover;border:1px solid var(--border)"><div style="flex:1"><strong>${esc(o.login)}</strong><div style="color:var(--muted);font-size:0.92rem">${esc(o.description||'')}</div></div><a style="color:var(--accent)" href="${o.html_url}" target="_blank" rel="noopener">View</a>`;
            orgsContainer.appendChild(d);
          });
        } else {
          console.debug('[profilev2] orgs.json empty or missing');
        }

        // repos
        const repos = await fetchJsonWithFallback('repos.json');
        if(!Array.isArray(repos) || repos.length === 0){
          reposGrid.innerHTML = '<div style="color:var(--muted)">Repository data not yet generated. Run the generator workflow.</div>';
          pinnedContainer.innerHTML = '<div style="color:var(--muted)">Repository data not yet generated.</div>';
          console.warn('[profilev2] repos.json empty or missing');
          return;
        }

        // last commit
        const last = repos.reduce((m,r)=> r.pushed_at > m ? r.pushed_at : m, repos[0].pushed_at || null);
        lastCommitEl.textContent = `Last commit: ${fmtDate(last)}`;

        // pinned handling
        const pinnedJson = await fetchJsonWithFallback('pinned.json');
        let pinnedNames = Array.isArray(pinnedJson?.pinned) ? pinnedJson.pinned : null;
        let pinnedItems = [];
        if(pinnedNames && pinnedNames.length){
          pinnedNames.forEach(name => {
            const found = repos.find(r => r.name.toLowerCase() === name.toLowerCase());
            if(found) pinnedItems.push(found);
          });
        }
        if(pinnedItems.length === 0){
          pinnedItems = [...repos].filter(r => !r.fork).sort((a,b)=> (b.stargazers_count - a.stargazers_count) || (new Date(b.pushed_at) - new Date(a.pushed_at))).slice(0,6);
        }

        // render pinned + all
        pinnedContainer.innerHTML = '';
        pinnedItems.forEach(r => pinnedContainer.appendChild(repoCard(r)));

        reposGrid.innerHTML = '';
        const sourceRepos = repos.filter(r => !r.fork);
        sourceRepos.forEach(r => reposGrid.appendChild(repoCard(r)));

        // stats UI
        const totalStars = sourceRepos.reduce((s,r)=> s + (r.stargazers_count||0), 0);
        const totalForks = sourceRepos.reduce((s,r)=> s + (r.forks_count||0), 0);
        mainStatsEl.innerHTML = `
          <div class="stat">‚≠ê Stars: <strong>${totalStars}</strong></div>
          <div class="stat">üç¥ Forks: <strong>${totalForks}</strong></div>
          <div class="stat">üì¶ Repos: <strong>${repos.length}</strong></div>
        `;

        console.info('[profilev2] data loaded and rendered successfully');
      })();

    })();
  </script>
</body>
</html>
