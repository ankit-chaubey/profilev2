<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Ankit Chaubey — Projects & Profile</title>
  <meta name="description" content="Ankit Chaubey — curiosity-driven learner. Systems, APIs, automation, and low-level tooling." />
  <meta name="theme-color" content="#0b1220" />

  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

  <style>
    :root{
      --bg:#0b1220; --panel:#0f172a; --text:#e6eef6; --muted:#9ca3af;
      --accent:#38bdf8; --accent-2:#7c3aed; --border:rgba(255,255,255,0.06);
      --card-radius:14px; --shadow:0 12px 36px rgba(2,6,23,0.55); --transition:300ms;
    }
    body.light{ --bg:#f8fafc; --panel:#fff; --text:#071022; --muted:#475569; --accent:#0284c7; --accent-2:#7c3aed; --border:rgba(15,23,42,0.06); --shadow:0 8px 24px rgba(2,6,23,0.06) }
    body.amoled{ --bg:#000; --panel:#000; --text:#e6eef6; --muted:#9aa4b2; --accent:#00e5ff; --accent-2:#ff3b99; --border:rgba(255,255,255,0.04); --shadow:none }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;font-family:Inter,system-ui,-apple-system,"Segoe UI",Roboto,Arial;
      color:var(--text); background:
      radial-gradient(900px 360px at 12% -12%, rgba(56,189,248,0.06), transparent),
      var(--bg);
      transition:background var(--transition), color var(--transition);
      -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale;
      line-height:1.5; padding-bottom:48px;
    }

    a{color:var(--accent)} a:hover{text-decoration:underline}

    .container{max-width:1100px;margin:28px auto;padding:22px}
    .theme-overlay{pointer-events:none;position:fixed;inset:0;background:var(--bg);opacity:0;transition:opacity 260ms;z-index:9999}
    .theme-changing .theme-overlay{opacity:1}

    header.top{display:flex;justify-content:space-between;align-items:center;gap:16px;margin-bottom:22px}
    .left{display:flex;align-items:center;gap:16px}
    .avatar{width:96px;height:96px;border-radius:50%;overflow:hidden;border:1px solid var(--border);background:linear-gradient(135deg,var(--accent),var(--accent-2));flex-shrink:0}
    .avatar img{width:100%;height:100%;object-fit:cover;display:block}

    h1{margin:0;font-size:20px}
    .subtitle{margin:6px 0 0 0;color:var(--muted)}

    .controls{display:flex;gap:8px}
    .btn{background:transparent;border:1px solid var(--border);color:var(--text);padding:8px 12px;border-radius:8px;cursor:pointer}
    .grid{display:grid;grid-template-columns:1fr 320px;gap:18px}
    .card{background:linear-gradient(180deg, rgba(255,255,255,0.01), transparent);border-radius:var(--card-radius);padding:16px;border:1px solid var(--border);box-shadow:var(--shadow)}
    .repo-grid{display:grid;grid-template-columns:repeat(2,1fr);gap:12px}
    .repo{padding:12px;border-radius:12px;border:1px solid var(--border);background:transparent}
    .stats{display:flex;gap:12px}
    .stat{padding:8px 12px;border-radius:10px;background:rgba(255,255,255,0.02)}

    @media(max-width:980px){ .grid{grid-template-columns:1fr} .repo-grid{grid-template-columns:repeat(1,1fr)} }
    @media(max-width:520px){ .repo p{min-height:28px} .meta-row{flex-direction:row} header.top{flex-direction:column;align-items:flex-start;gap:12px} }

    .contrib{width:100%;border-radius:8px;overflow:hidden;border:1px solid var(--border);margin-top:8px}
    .contrib img{display:block;width:100%;height:auto}

    .fade{opacity:0;transform:translateY(8px);transition:opacity 420ms,transform 420ms}
    .fade.show{opacity:1;transform:none}

    .skeleton{background:linear-gradient(90deg, rgba(255,255,255,0.02), rgba(255,255,255,0.04), rgba(255,255,255,0.02));height:12px;border-radius:6px;animation:shimmer 1.6s linear infinite}
    @keyframes shimmer{0%{background-position:-200px 0}100%{background-position:200px 0}}

    .error-overlay{position:fixed;left:12px;right:12px;top:12px;z-index:99999;background:rgba(200,30,30,0.95);color:#fff;padding:12px;border-radius:8px;font-family:monospace;font-size:13px;white-space:pre-wrap;max-height:40vh;overflow:auto}
    footer{text-align:center;margin-top:28px;color:var(--muted)}
  </style>
</head>
<body>
  <div class="theme-overlay" aria-hidden="true"></div>

  <main class="container" role="main" aria-live="polite">
    <header class="top fade" role="banner">
      <div class="left">
        <div class="avatar" id="avatarWrap"><img id="avatar" src="" alt="Avatar"></div>
        <div>
          <h1 id="name">Ankit Chaubey</h1>
          <p class="subtitle" id="bio">Curiosity-driven learner exploring systems, APIs, automation, and low-level tooling.</p>
          <p style="margin:6px 0 0 0;color:var(--muted)" id="joined">Joined: — · Username: <span id="login">—</span></p>
        </div>
      </div>

      <nav class="controls" aria-label="Site controls">
        <a id="profileBtn" class="btn" href="#" target="_blank" rel="noopener">View GitHub</a>
        <button id="themeBtn" class="btn" aria-label="Toggle theme">Theme</button>
      </nav>
    </header>

    <div class="grid">
      <aside>
        <div class="card fade">
          <div class="stats" id="mainStats"><div class="stat">Loading…</div></div>

          <div style="margin-top:12px">
            <strong>What I use</strong>
            <div style="margin-top:8px;display:flex;flex-wrap:wrap;gap:8px">
              <span class="lang-pill">Python</span>
              <span class="lang-pill">Go</span>
              <span class="lang-pill">C / C++</span>
              <span class="lang-pill">Linux</span>
            </div>
          </div>

          <div style="width:220px;margin-top:12px">
            <div class="contrib" aria-hidden="false" title="Contribution graph">
              <img id="contrib" src="" alt="Contribution graph" onerror="this.style.display='none'">
            </div>
          </div>

          <hr style="margin:16px 0;border:none;border-top:1px solid var(--border)">

          <div style="display:flex;justify-content:space-between;align-items:center">
            <div>
              <div class="small">Last commit: <span id="lastCommit">—</span></div>
            </div>
          </div>
        </div>

        <section class="card fade" style="margin-top:14px">
          <h3 style="margin-top:0">Organizations</h3>
          <div id="orgs" style="margin-top:8px"><div class="skeleton" style="width:80%;height:12px;border-radius:6px"></div></div>
        </section>

        <section class="card fade" style="margin-top:14px">
          <h3 style="margin-top:0">Activity & summary</h3>
          <div style="margin-top:8px;color:var(--muted)">
            <div>Total public repos: <strong id="totalPublic">—</strong></div>
            <div>Source repos indexed: <strong id="totalSource">—</strong></div>
            <div>Total forks: <strong id="totalForks">—</strong></div>
            <div>Followers: <strong id="followers">—</strong></div>
            <div>Total commits (partial): <strong id="totalCommits">—</strong></div>
            <div style="margin-top:8px">Last updated: <strong id="updatedAt">—</strong></div>
          </div>
        </section>
      </aside>

      <section class="card fade" style="margin-top:0">
        <h2 id="aboutTitle">About</h2>
        <p id="aboutText">I’m a college student from India who enjoys understanding how systems work by building small tools, experimenting with APIs, and automating workflows.</p>

        <div style="display:flex;gap:16px;align-items:flex-start;margin-top:12px">
          <div style="flex:1">
            <p>
              <strong>GitHub:</strong> <span id="loginInline">—</span><br>
              <strong>Telegram:</strong> <a href="https://t.me/ankify" target="_blank">@ankify</a>
            </p>
          </div>
        </div>

        <section class="card fade" style="margin-top:20px">
          <h2 style="margin-top:0">All repositories</h2>
          <div id="reposGrid" class="repo-grid" style="margin-top:12px">
            <div class="repo"><div class="skeleton" style="width:60%"></div><div style="height:10px;margin-top:10px" class="skeleton"></div></div>
            <div class="repo"><div class="skeleton" style="width:60%"></div><div style="height:10px;margin-top:10px" class="skeleton"></div></div>
          </div>
        </section>

      </section>
    </div>

    <footer class="fade" style="margin-top:24px">© <span id="year"></span> Ankit Chaubey · Built with simplicity</footer>
  </main>

  <script>
    /*
      Robust viewer script:
      - computes DATA_BASE dynamically (works at / or /<repo>/)
      - fetches files with fallback and logs useful diagnostics
      - improved computeSiteBase and clearer fetch failure overlay
    */

    (function(){
      // Error overlay helper
      function showError(msg){
        let o = document.getElementById('__pp_error_overlay');
        if(!o){
          o = document.createElement('div');
          o.id = '__pp_error_overlay';
          o.className = 'error-overlay';
          document.body.appendChild(o);
        }
        o.textContent = msg;
      }
      window.addEventListener('error', e => { showError('Runtime error: ' + (e.error?.stack || e.message || e.toString())); });
      window.addEventListener('unhandledrejection', e => { showError('UnhandledRejection: ' + (e.reason?.stack || e.reason?.message || String(e.reason))); });

      // Compute site base (works on /, /repo, /repo/, /repo/index.html)
      function computeSiteBase(){
        // e.g. pathname = "/profilev2/" or "/profilev2/index.html" or "/"
        let p = location.pathname || '/';
        // If path doesn't end with '/', decide whether the last segment is a filename (has a dot).
        if(!p.endsWith('/')){
          const last = p.slice(p.lastIndexOf('/') + 1);
          if(last.includes('.')){
            // looks like a filename: strip it (keep the directory)
            const idx = p.lastIndexOf('/');
            p = idx >= 0 ? p.slice(0, idx+1) : '/';
          } else {
            // looks like a directory without trailing slash: keep it and add slash
            p = p + '/';
          }
        }
        // ensure it ends with slash
        if(!p.endsWith('/')) p += '/';
        return p;
      }

      const SITE_BASE = computeSiteBase();
      const DATA_BASE = SITE_BASE + 'data'; // e.g. '/profilev2/data' or '/data' depending on site
      console.debug('[profilev2] SITE_BASE', SITE_BASE, 'DATA_BASE', DATA_BASE);

      function dataUrl(name){ return `${DATA_BASE}/${name.replace(/^\/+/, '')}`; }

      async function fetchJsonWithFallback(name){
        const u1 = dataUrl(name);
        try {
          console.debug('[profilev2] fetch', u1);
          const r = await fetch(u1, {cache:'no-cache'});
          if(r.ok) return await r.json();
          console.warn('[profilev2] fetch status', r.status, 'for', u1);
        } catch(e){ console.warn('[profilev2] fetch error', e, u1); }

        const u2 = `/data/${name.replace(/^\/+/, '')}`;
        try {
          console.debug('[profilev2] fallback fetch', u2);
          const r2 = await fetch(u2, {cache:'no-cache'});
          if(r2.ok) return await r2.json();
          console.warn('[profilev2] fallback status', r2.status, 'for', u2);
        } catch(e){ console.warn('[profilev2] fallback fetch error', e, u2); }

        // Both attempts failed — make it visible on-page for easier diagnosis.
        try {
          showError(`Failed fetching data("${name}") from:\n  ${u1}\n  ${u2}\nOpen DevTools Network tab and check these URLs (status, response).`);
        } catch(e){
          console.error('[profilev2] failed to show fetch error overlay', e);
        }
        return null;
      }

      // helper DOM queries
      function qs(sel){ return document.querySelector(sel); }
      function qsa(sel){ return Array.from(document.querySelectorAll(sel)); }

      const avatarEl = qs('#avatar');
      const nameEl = qs('#name');
      const bioEl = qs('#bio');
      const joinedEl = qs('#joined');
      const profileBtn = qs('#profileBtn');
      const loginEl = qs('#login');
      const loginInlineEl = qs('#loginInline');

      const mainStatsEl = qs('#mainStats'), pinnedContainer = qs('#pinned'), reposGrid = qs('#reposGrid');
      const orgsContainer = qs('#orgs'), lastCommitEl = qs('#lastCommit');
      const totalPublicEl = qs('#totalPublic'), totalSourceEl = qs('#totalSource'), totalForksEl = qs('#totalForks');
      const followersEl = qs('#followers'), totalCommitsEl = qs('#totalCommits'), updatedAtEl = qs('#updatedAt'), yearEl = qs('#year');

      yearEl.textContent = new Date().getFullYear();

      function fmtDate(iso){ if(!iso) return '—'; try{ return new Date(iso).toLocaleDateString(); }catch(e){ return iso; } }
      function esc(s){ return s ? s.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;') : ''; }

      // theme cycle
      (function themeInit(){
        const THEMES = ['dark','light','amoled'];
        const KEY = 'site-theme';
        const overlay = document.querySelector('.theme-overlay');
        const btn = qs('#themeBtn');
        function get(){ return localStorage.getItem(KEY) || (matchMedia('(prefers-color-scheme: light)').matches ? 'light' : 'dark'); }
        function apply(t){ document.body.classList.remove(...THEMES); document.body.classList.add(t); btn.textContent = `Theme (${t})`; }
        function cycle(){ const cur = get(); const idx = THEMES.indexOf(cur); const nxt = THEMES[(idx+1)%THEMES.length]; document.body.classList.add('theme-changing'); overlay.style.opacity='1'; setTimeout(()=>{ localStorage.setItem(KEY,nxt); apply(nxt); overlay.style.opacity='0'; setTimeout(()=>document.body.classList.remove('theme-changing'),300); },230); }
        apply(get()); btn.addEventListener('click', cycle); window.addEventListener('keydown', e => { if(e.key === 't' && !/input|textarea/i.test(document.activeElement?.tagName)) cycle(); });
      })();

      // load everything
      (async function loadAll(){
        try{
          const summary = await fetchJsonWithFallback('summary.json');
          if(summary){
            totalPublicEl.textContent = summary.total_public_repos ?? '—';
            totalSourceEl.textContent = summary.source_repos_count ?? '—';
            totalForksEl.textContent = summary.total_forks ?? '—';
            followersEl.textContent = summary.followers ?? '—';
            totalCommitsEl.textContent = summary?.total_commits ? `${summary.total_commits} (partial)` : (summary?.total_commits === null ? '—' : (summary?.total_commits ?? '—'));
            updatedAtEl.textContent = summary.updated_at ? fmtDate(summary.updated_at) : (summary.updatedAt ? fmtDate(summary.updatedAt) : '—');
          }

          const profile = await fetchJsonWithFallback('profile.json');
          if(profile){
            avatarEl.src = profile.avatar_url || '';
            nameEl.textContent = profile.name || profile.login || '—';
            bioEl.textContent = profile.bio || '';
            joinedEl.textContent = `Joined: ${profile.created_at ? fmtDate(profile.created_at) : '—'} · Username: ${profile.login || '—'}`;
            profileBtn.href = profile.html_url || '#';
            loginEl.textContent = profile.login || '—';
            loginInlineEl.textContent = profile.login || '—';
          }

          const orgs = await fetchJsonWithFallback('orgs.json');
          if(Array.isArray(orgs) && orgs.length){
            orgsContainer.innerHTML = '';
            orgs.forEach(o=>{
              const d = document.createElement('div');
              d.style.display = 'flex';
              d.style.alignItems = 'center';
              d.style.gap = '8px';
              d.innerHTML = `<img src="${o.avatar_url}" style="width:28px;height:28px;border-radius:6px" alt="${esc(o.login)}"> <div style="font-size:13px">${esc(o.login)}</div>`;
              orgsContainer.appendChild(d);
            });
          }

          const contribUrl = dataUrl('contrib.svg');
          const contribEl = qs('#contrib');
          contribEl.src = contribUrl;

          const pinned = await fetchJsonWithFallback('pinned.json');
          // pinned may be simple structure; ignore if missing

          const repos = await fetchJsonWithFallback('repos.json');
          if(Array.isArray(repos)){
            reposGrid.innerHTML = '';
            repos.slice(0,50).forEach(repo=>{
              const r = document.createElement('div');
              r.className = 'repo';
              const desc = repo.description ? `<div style="margin-top:6px;color:var(--muted)">${esc(repo.description)}</div>` : '';
              r.innerHTML = `<div><strong><a href="${repo.html_url}" target="_blank" rel="noopener">${esc(repo.name)}</a></strong>${desc}</div>`;
              reposGrid.appendChild(r);
            });
          }

          // reveal fade elements
          qsa('.fade').forEach(el=>el.classList.add('show'));

          console.info('[profilev2] rendered repos:', Array.isArray(repos) ? repos.length : 0);
        }catch(err){
          console.error('Render error', err);
          showError('Render error: ' + (err.stack || err.message || err));
        }
      })();
    })();
  </script>
</body>
</html>
